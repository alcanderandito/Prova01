<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Demo tastiera virtuale</title>
<style>
/* layout di pagina minimo */
body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif;margin:0;display:flex;flex-direction:column;height:100vh}
main{flex:1;display:flex;flex-direction:column;gap:8px;padding:16px;overflow:auto}
input{padding:8px 10px;font-size:16px;border:1px solid #ccc;border-radius:6px;width:100%}
button{padding:8px 14px;font-size:16px}

#vk{position:fixed;left:0;right:0;bottom:0;background:#e5e5e5;box-shadow:0 -2px 5px #0003;padding:8px 4px;display:none;z-index:99}
#vk .row{display:flex;justify-content:center;gap:4px;margin-bottom:6px}
#vk button{flex:1;min-width:0;padding:12px 0;font-size:17px;border:none;border-radius:6px;background:#fff;box-shadow:0 1px 2px #0002}
#vk button.func{flex:1.5;background:#d0d0d0}
#vk button:active{background:#c0ffc0}
</style>
</head>
<body>

<main>
  <h2>Prova la tastiera virtuale</h2>
  <input class="use-vk" placeholder="Scrivi qui…">
  <input class="use-vk" placeholder="…o qui">
  <button onclick="alert('Normale bottone, la tastiera non si apre')">Altro controllo</button>
</main>

<!-- contenedor tastiera -->
<div id="vk"></div>

<script>
/* ---------- dati layout ---------- */
const rows = [
  ['q','w','e','r','t','y','u','i','o','p'],
  ['a','s','d','f','g','h','j','k','l'],
  ['Shift','z','x','c','v','b','n','m','←'],
  ['123','Space','Invio']
];

let shift = false, target = null;   // stato corrente

/* ---------- crea tastiera ---------- */
const vk = document.getElementById('vk');
rows.forEach(r=>{
  const div = document.createElement('div');
  div.className='row';
  r.forEach(key=>{
    const b=document.createElement('button');
    b.textContent=key==='Space'?'␣':key;
    if(/Shift|←|Invio|123/.test(key)) b.className='func';
    b.dataset.key=key;
    div.appendChild(b);
  });
  vk.appendChild(div);
});

/* ---------- apertura / chiusura ---------- */
document.addEventListener('focusin',e=>{
  if(e.target.classList.contains('use-vk')){
    target=e.target; vk.style.display='block'; window.scrollTo(0,document.body.scrollHeight);
  }
});
document.addEventListener('focusout',e=>{
  if(e.target===target) setTimeout(()=>{ if(!vk.contains(document.activeElement)) vk.style.display='none'; },10);
});

/* ---------- gestione click ---------- */
vk.addEventListener('click',e=>{
  if(e.target.tagName!=='BUTTON'||!target)return;
  const k=e.target.dataset.key;
  if(k==='Shift'){shift=!shift; e.target.classList.toggle('active',shift);return;}
  if(k==='←'){target.value=target.value.slice(0,-1);return;}
  if(k==='Space'){target.value+=' ';return;}
  if(k==='Invio'){vk.style.display='none';target.dispatchEvent(new Event('change'));target.blur();return;}
  if(k==='123'){/* esempio cambio layout numerico */return;}
  target.value+=shift?k.toUpperCase():k;
});

/* opzionale: chiudi tastiera con ESC su desktop */
addEventListener('keydown',e=>{if(e.key==='Escape')vk.style.display='none';});
</script>
</body>
</html>
