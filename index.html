<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Team Due Mori (Mobile Only)</title>

<style>
/* RESET ------------------------------------------------------------------ */
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;font-family:Arial,Helvetica,sans-serif;overflow-y:scroll;}

/* -------------------------  MOBILE 0‚Äë600‚ÄØpx  ---------------------------- */
@media (max-width:600px){

/* variabili safe‚Äëarea */
:root{
  --safeT: env(safe-area-inset-top);
  --safeB: env(safe-area-inset-bottom);
}

/* sfondo ----------------------------------------------------------------- */
.bg{position:fixed;top:50%;left:50%;width:120%;height:120%;object-fit:cover;
    transform:translate(-50%,-50%);z-index:-2;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:-1;pointer-events:none;}

/* landing --------------------------------------------------------------- */
header{height:100dvh;display:flex;flex-direction:column;align-items:center;justify-content:center;
       text-align:center;color:#fff;padding:0 20px;}
header h1{font-size:2.2rem;font-weight:700;letter-spacing:.05em;text-shadow:0 1px 4px rgba(0,0,0,.7);}
.subtitle{font-size:.95rem;margin:.6em 0;text-shadow:0 1px 3px rgba(0,0,0,.7);}
#scrollIndicator{font-size:2rem;cursor:pointer;animation:pulse 1.5s ease-in-out infinite;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.3);}}

/* griglia card ----------------------------------------------------------- */
main{position:relative;z-index:1;min-height:200vh;padding:40px 20px 80px;}
.nav{display:grid;gap:20px;grid-template-columns:repeat(2,1fr);justify-items:center;max-width:480px;margin:0 auto;}
.nav a{width:100px;height:100px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;
       background:rgba(255,255,255,.45);backdrop-filter:blur(4px);font-size:.9rem;font-weight:600;
       border:1px solid rgba(255,255,255,.3);box-shadow:0 4px 12px rgba(0,0,0,.2);
       opacity:0;transform:scale(0);animation:popIn .5s ease forwards,breath 3s ease-in-out infinite .6s;}
@keyframes popIn{0%{opacity:0;transform:scale(0);}60%{opacity:1;transform:scale(1.2);}100%{opacity:1;transform:scale(1);} }
@keyframes breath{0%,100%{transform:scale(1);}50%{transform:scale(1.05);} }

/* pulsante chat ---------------------------------------------------------- */
#chatToggle{position:fixed;top:calc(1rem + var(--safeT));right:1rem;width:60px;height:60px;border:none;border-radius:50%;
            background:#25d366 url("https://img.icons8.com/ios-filled/50/ffffff/chat--v1.png") center/60% no-repeat;
            cursor:pointer;z-index:1000;box-shadow:0 4px 14px rgba(0,0,0,.25);}
#chatToggle:active{transform:scale(.9);}

/* CHAT full‚Äëscreen ------------------------------------------------------- */
#chatContainer{position:fixed;inset:0;display:none;flex-direction:column;width:100vw;
               background:#ece5dd;z-index:1100;overscroll-behavior-y:contain;touch-action:pan-y;}

/* wallpaper tipo WhatsApp */
#chatContainer::before{content:"";position:absolute;inset:0;
  background:url("https://raw.githubusercontent.com/raj457036/whatsapp-chat-background/master/bg.png") top left/540px repeat;
  opacity:.15;z-index:0;}

/* barra top -------------------------------------------------------------- */
.chatBar{
  position:fixed;top:0;left:0;width:100%;
  height:calc(56px + var(--safeT));padding:calc(var(--safeT) + 10px) 16px 10px 16px;
  background:#075e54;display:flex;align-items:center;gap:10px;color:#fff;font-weight:500;font-size:16px;z-index:3;
}
.chatBar img.avatar{width:32px;height:32px;border-radius:50%;object-fit:cover;}
.chatBar .name{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.chatBar .wIcon{width:22px;height:22px;cursor:pointer;filter:invert(1) brightness(2);}

/* corpo chat ------------------------------------------------------------- */
.chatBody{
  position:absolute;left:0;right:0;
  top:calc(56px + var(--safeT));
  bottom:calc(72px + var(--safeB));
  overflow-y:auto;padding:10px 12px 90px 12px;display:flex;flex-direction:column;gap:6px;transition:bottom .2s;
}

/* input bar -------------------------------------------------------------- */
.chatInput{
  position:fixed;left:0;right:0;
  bottom:var(--safeB);display:flex;align-items:center;gap:8px;
  padding:8px 8px calc(8px + var(--safeB));background:#f0f0f0;z-index:3;transition:transform .2s;
}
.chatInput input{flex:1;padding:10px 12px;border:none;border-radius:20px;font-size:15px;background:#fff;}
.chatInput button{width:48px;height:48px;border:none;border-radius:50%;background:#25d366;
                  display:flex;align-items:center;justify-content:center;}
.wIcon.inline{filter:none;width:30px;height:30px;}

/* bubble ----------------------------------------------------------------- */
.msg{max-width:80%;display:flex;flex-direction:column;position:relative;}
.bubble{padding:6px 8px 16px 8px;font-size:14px;line-height:1.3;border-radius:8px;box-shadow:0 1px 1px rgba(0,0,0,.1);}
.time{position:absolute;bottom:2px;right:6px;font-size:11px;opacity:.6;white-space:nowrap;}
.bot .bubble{background:#fff;border-radius:0 8px 8px 8px;}
.user .bubble{background:#d1f8c6;border-radius:8px 0 8px 8px;align-self:flex-end;}
.user .bubble::after{content:"‚úî‚úî";font-size:11px;position:absolute;bottom:2px;right:-18px;
                     color:#34b7f1;font-weight:700;font-family:Arial,Helvetica,sans-serif;}
}

/* ---------------------------  DESKTOP >600‚ÄØpx  -------------------------- */
@media (min-width:601px){
  header,main,#chatToggle,#chatContainer,.bg,.overlay{display:none!important;}
  body::before{content:'üõë Solo smartphone';white-space:pre-line;display:flex;align-items:center;justify-content:center;
               height:100vh;width:100%;font-size:2.5rem;background:#000;color:#fff;padding:0 5vw;text-align:center;}
  html,body{overflow:hidden;}
}
</style>
</head>
<body>
<!-- sfondo -->
<img src="home1.PNG" alt="sfondo" class="bg" id="bg"><div class="overlay"></div>

<!-- pulsante chat -->
<button id="chatToggle" aria-label="Apri chat"></button>

<!-- CHAT ----------------------------------------------------------------->
<div id="chatContainer">
  <div class="chatBar">
    <img src="avatar-roberta.jpg" alt="" class="avatar">
    <span class="name">Ro‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
    <img src="https://img.icons8.com/ios-glyphs/30/ffffff/video-call.png" class="wIcon" alt="video">
    <img src="https://img.icons8.com/ios-glyphs/30/ffffff/phone.png" class="wIcon" style="margin-left:8px" alt="call">
    <span id="chatClose" style="font-size:26px;margin-left:12px;cursor:pointer;">‚úï</span>
  </div>

  <div class="chatBody" id="chatBody"></div>

  <form class="chatInput" id="chatForm" autocomplete="off">
    <img src="https://img.icons8.com/ios-glyphs/30/000000/plus-math.png" class="wIcon inline">
    <input id="chatInputField" placeholder="Messaggio" />
    <img src="https://img.icons8.com/ios-glyphs/30/000000/camera.png" class="wIcon inline">
    <img src="https://img.icons8.com/ios-glyphs/30/000000/image.png"  class="wIcon inline">
    <button type="submit" aria-label="Invia">
      <img src="https://img.icons8.com/ios/50/ffffff/filled-sent.png" style="width:24px;height:24px;">
    </button>
  </form>
</div>

<!-- landing ------------------------------------------------------------->
<header>
  <h1>Team Due Mori</h1>
  <div class="subtitle">Sfoglia le schede del Dream‚ÄëTeam.</div>
  <div id="scrollIndicator">‚¨áÔ∏é</div>
</header>
<main><nav class="nav" id="teamNav"></nav></main>

<script>
/* PARALLAX --------------------------------------------------------------- */
const bg=document.getElementById('bg'),teamNav=document.getElementById('teamNav'),
      scrollIndicator=document.getElementById('scrollIndicator');
window.addEventListener('scroll',()=>{const f=Math.min(scrollY/200,1);
  bg.style.transform=`translate(-50%,-50%) scale(${1+f*0.5})`;});
scrollIndicator.onclick=()=>teamNav.scrollIntoView({behavior:'smooth'});

/* ELEMENTI CHAT ---------------------------------------------------------- */
const chatToggle=document.getElementById('chatToggle'),chatContainer=document.getElementById('chatContainer'),
      chatClose=document.getElementById('chatClose'),chatBody=document.getElementById('chatBody'),
      chatForm=document.getElementById('chatForm'),chatInput=document.getElementById('chatInputField'),history=[];

/* apre/chiude chat ------------------------------------------------------- */
chatToggle.onclick=()=>{document.body.classList.add('chat-open');
  chatContainer.style.display='flex';chatInput.focus();};
chatClose.onclick=()=>{chatContainer.style.display='none';
  document.body.classList.remove('chat-open');};

/* append messaggio ------------------------------------------------------- */
function append(who,text){
  const row=document.createElement('div');
  row.className='msg '+who;
  row.innerHTML=`<div class="bubble">${text}</div>`;
  const now=new Date().toLocaleTimeString('it-IT',{hour:'2-digit',minute:'2-digit'});
  row.querySelector('.bubble').insertAdjacentHTML('beforeend',`<span class="time">${now}</span>`);
  chatBody.appendChild(row);
  chatBody.scrollTop=chatBody.scrollHeight;
}

/* submit ----------------------------------------------------------------- */
chatForm.addEventListener('submit',async e=>{
  e.preventDefault();
  const text=chatInput.value.trim();if(!text) return;
  append('user',text);history.push({role:'user',content:text});chatInput.value='';
  try{
    const r=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},
                                     body:JSON.stringify({message:text,history})});
    const {reply}=await r.json();
    append('bot',reply);history.push({role:'assistant',content:reply});
  }catch{append('bot','Errore di connessione üò¢');}
});

/* FIX tastiera + barra Safari ------------------------------------------- */
(function(){
  const supportsDVH=CSS.supports('height','100dvh'); /* nuovi Safari */
  /* fallback viewport unit */
  const setVh=()=>{
    const h=window.visualViewport?window.visualViewport.height:window.innerHeight;
    document.documentElement.style.setProperty('--vh',`${h*0.01}px`);
  };
  if(!supportsDVH){
    setVh();
    if(window.visualViewport){
      visualViewport.addEventListener('resize',setVh);
      visualViewport.addEventListener('scroll',setVh);
    }else window.addEventListener('resize',setVh);
    /* usiamo la variabile nel CSS */
    document.getElementById('chatContainer').style.height='calc(var(--vh)*100)';
  }

  /* sposta input quando appare la tastiera */
  if(window.visualViewport){
    const vv=visualViewport;
    const fixKB=()=>{
      const gap=Math.max(0,window.innerHeight - vv.height - vv.offsetTop);
      document.querySelector('.chatInput').style.transform=`translateY(-${gap}px)`;
      document.querySelector('.chatBody').style.bottom=`calc(72px + var(--safeB) + ${gap}px)`;
    };
    vv.addEventListener('resize',fixKB);vv.addEventListener('scroll',fixKB);
  }
})();
</script>
</body>
</html>
