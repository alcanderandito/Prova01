<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Team Due Mori (Mobile Only)</title>

  <style>
    /* RESET e font base  */
    *{margin:0;padding:0;box-sizing:border-box;}
    html,body{width:100%;height:100%;overflow-y:scroll;font-family:Arial,Helvetica,sans-serif;}

    /* ---------------------------  MOBILE ≤600 px  --------------------------- */
    @media (max-width:600px){

      /* Sfondo parallax */
      .bg{position:fixed;top:50%;left:50%;width:120%;height:120%;object-fit:cover;
          transform:translate(-50%,-50%);transform-origin:center;z-index:-2;}
      .overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:-1;pointer-events:none;}

      /* Landing header */
      header{height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;
             text-align:center;color:#fff;padding:0 20px;}
      header h1{font-size:2.2rem;font-weight:700;letter-spacing:.05em;text-shadow:0 1px 4px rgba(0,0,0,.7);}
      .subtitle{font-size:.95rem;margin:.6em 0;text-shadow:0 1px 3px rgba(0,0,0,.7);}
      #scrollIndicator{font-size:2rem;cursor:pointer;animation:pulse 1.5s ease-in-out infinite;}
      @keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.3);}}

      /* Griglia 2×N */
      main{position:relative;z-index:1;min-height:200vh;padding:40px 20px 80px;}
      .nav{display:grid;gap:20px;grid-template-columns:repeat(2,1fr);justify-items:center;max-width:480px;margin:0 auto;}
      .nav a{width:100px;height:100px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;
             background:rgba(255,255,255,.45);backdrop-filter:blur(4px);font-size:.9rem;font-weight:600;
             border:1px solid rgba(255,255,255,.3);box-shadow:0 4px 12px rgba(0,0,0,.2);
             opacity:0;transform:scale(0);animation:popIn .5s ease forwards,breath 3s ease-in-out infinite .6s;}
      @keyframes popIn{0%{opacity:0;transform:scale(0);}60%{opacity:1;transform:scale(1.2);}100%{opacity:1;transform:scale(1);} }
      @keyframes breath{0%,100%{transform:scale(1);}50%{transform:scale(1.05);} }

      /* Pulsante chat */
      #chatToggle{position:fixed;top:1rem;right:1rem;width:60px;height:60px;border:none;border-radius:50%;
                  background:#25d366 url("https://img.icons8.com/ios-filled/50/ffffff/chat--v1.png") center/60% no-repeat;
                  cursor:pointer;z-index:1000;box-shadow:0 4px 14px rgba(0,0,0,.25);}
      #chatToggle:active{transform:scale(.9);}

      /* Chat full‑screen */
      #chatContainer{position:fixed;inset:0;display:none;flex-direction:column;width:100vw;height:100dvh;
                     background:#ece5dd;z-index:1100;}

      /* Barra top fissa */
      .chatBar{position:fixed;top:0;left:0;width:100%;height:56px;background:#075e54;color:#fff;
               display:flex;align-items:center;padding:0 16px;font-weight:700;font-size:16px;z-index:2;}

      /* Input fissa in basso (rispetta la safe‑area degli iPhone) */
      .chatInput{position:fixed;left:0;right:0;bottom:env(safe-area-inset-bottom);
                 display:flex;align-items:center;gap:6px;padding:8px 8px calc(8px + env(safe-area-inset-bottom));
                 background:#f0f0f0;z-index:2;}
      .chatInput input{flex:1;padding:10px 12px;border:none;border-radius:20px;font-size:15px;}
      .chatInput button{width:48px;height:48px;border:none;border-radius:50%;background:#25d366;color:#fff;
                        font-size:20px;display:flex;align-items:center;justify-content:center;}

      /* Area messaggi occupa lo spazio fra le due barre */
      .chatBody{position:absolute;top:56px;bottom:72px;left:0;right:0;overflow-y:auto;
                padding:10px 12px;display:flex;flex-direction:column;gap:6px;}

      .bubble{padding:8px 10px;max-width:80%;font-size:14px;line-height:1.3;border-radius:8px;box-shadow:0 1px 1px rgba(0,0,0,.1);}
      .bot .bubble{background:#fff;color:#000;border-radius:0 8px 8px 8px;}
      .user .bubble{background:#dcf8c6;color:#000;border-radius:8px 0 8px 8px;align-self:flex-end;}
    }

    /* ----------------------  BLOCCO DESKTOP >600 px  ---------------------- */
    @media (min-width:601px){
      header,main,#chatToggle,#chatContainer,.bg,.overlay{display:none!important;}
      body::before{content:'🛑 Solo smartphone';white-space:pre-line;display:flex;align-items:center;justify-content:center;
                   height:100vh;width:100%;font-size:2.5rem;background:#000;color:#fff;padding:0 5vw;text-align:center;}
      html,body{overflow:hidden;}
    }
  </style>
</head>
<body>
  <!-- Sfondo -->
  <img src="home1.PNG" alt="sfondo" class="bg" id="bg"><div class="overlay"></div>

  <!-- Pulsante chat -->
  <button id="chatToggle" aria-label="Apri chat"></button>

  <!-- Chat -->
  <div id="chatContainer">
    <div class="chatBar">Don Alfred 🤵🏻‍♂️ <span id="chatClose" style="margin-left:auto;font-size:24px;cursor:pointer;">✕</span></div>
    <div class="chatBody" id="chatBody"></div>
    <form class="chatInput" id="chatForm" autocomplete="off">
      <input id="chatInputField" placeholder="Scrivi un messaggio…" />
      <button type="submit">➤</button>
    </form>
  </div>

  <!-- Landing -->
  <header>
    <h1>Team Due Mori</h1>
    <div class="subtitle">Sfoglia le schede del Dream‑Team.</div>
    <div id="scrollIndicator">⬇︎</div>
  </header>
  <main><nav class="nav" id="teamNav"></nav></main>

  <script>
    /* Parallax background */
    const bg   = document.getElementById('bg'),
          teamNav = document.getElementById('teamNav'),
          scrollIndicator = document.getElementById('scrollIndicator');
    window.addEventListener('scroll',()=>{const f=Math.min(scrollY/200,1);bg.style.transform=`translate(-50%,-50%) scale(${1+f*0.5})`;});
    scrollIndicator.onclick = ()=> teamNav.scrollIntoView({behavior:'smooth'});

    /* Chat */
    const chatToggle   = document.getElementById('chatToggle'),
          chatContainer= document.getElementById('chatContainer'),
          chatClose    = document.getElementById('chatClose'),
          chatBody     = document.getElementById('chatBody'),
          chatForm     = document.getElementById('chatForm'),
          chatInput    = document.getElementById('chatInputField'),
          history      = [];

    chatToggle.onclick = ()=>{chatContainer.style.display='flex';chatInput.focus();};
    chatClose .onclick = ()=> chatContainer.style.display='none';

    function append(who,text){
      const row=document.createElement('div');
      row.className='msg '+who;
      row.innerHTML=`<div class="bubble">${text}</div>`;
      chatBody.appendChild(row);
      chatBody.scrollTop=chatBody.scrollHeight;
    }

    chatForm.addEventListener('submit',async e=>{
      e.preventDefault();
      const text = chatInput.value.trim();
      if(!text) return;
      append('user',text); history.push({role:'user',content:text});
      chatInput.value='';
      try{
        const r = await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},
                                          body:JSON.stringify({message:text,history})});
        const {reply}= await r.json();
        append('bot',reply); history.push({role:'assistant',content:reply});
      }catch{ append('bot','Errore di connessione 😢'); }
    });
  </script>
</body>
</html>
