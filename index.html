<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Team Due Mori</title>

  <!--  Sfondo / tua grafica  ------------------------------------------------>
  <style>
    html,body{
      margin:0;min-height:100%;font-family:system-ui,sans-serif;
      background:url("tuo_sfondo.jpg") center/cover fixed;
    }
    h1{color:#fff;text-align:center;margin-top:35vh;font-size:3rem;
        text-shadow:0 2px 6px rgba(0,0,0,.6);}
  </style>

  <!--  Chat widget --------------------------------------------------------->
  <style>
    #alfred-container{
      position:fixed;top:1rem;right:1rem;width:320px;max-width:90vw;
      font-family:inherit;z-index:9999;
    }
    #alfred-header{
      display:flex;justify-content:space-between;align-items:center;
      background:#1e3446;color:#fff;border-radius:6px 6px 0 0;
      padding:.45rem .65rem;font-weight:600;user-select:none;
    }
    #alfred-close{background:none;border:none;color:#fff;font-size:20px;line-height:1;cursor:pointer;}
    #alfred-body{
      background:#fafafa;border:1px solid #eee;border-top:none;
      height:330px;overflow-y:auto;padding:.6rem;font-size:15px;
    }
    #alfred-input{
      width:100%;border:1px solid #ccc;border-radius:4px;
      padding:.45rem .55rem;font-size:15px;margin:.45rem 0 .6rem;
    }
    .bubble{display:inline-block;padding:.35rem .6rem;border-radius:18px;margin:.25rem 0;max-width:90%}
    .user .bubble{background:#0092ff;color:#fff;margin-left:auto}
    .bot  .bubble{background:#e7ecef;color:#222}
  </style>
</head>

<body>
  <h1>Team Due Mori</h1>

  <!-- Chat widget -->
  <div id="alfred-container">
    <div id="alfred-header">
      Alfred Bot ðŸ¤–
      <button id="alfred-close">Ã—</button>
    </div>
    <div id="alfred-body"></div>
    <input id="alfred-input" placeholder="Scrivi qui..." autocomplete="off" />
  </div>

  <!-- Chat script -->
  <script>
    const bodyEl  = document.getElementById("alfred-body");
    const inputEl = document.getElementById("alfred-input");
    const closeEl = document.getElementById("alfred-close");

    function append(text, who){
      const wrap = document.createElement("div");
      wrap.className = who;
      wrap.innerHTML = `<div class="bubble">${text}</div>`;
      bodyEl.appendChild(wrap);
      bodyEl.scrollTop = bodyEl.scrollHeight;
    }

    async function send(){
      const text = inputEl.value.trim();
      if(!text) return;
      append(text,"user");
      inputEl.value="";
      try{
        const r = await fetch("/api/chat",{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({message:text})
        });
        const {reply}=await r.json();
        append(reply,"bot");
      }catch(e){
        append("Errore di connessione ðŸ˜¢","bot");
      }
    }

    inputEl.addEventListener("keydown",e=>{
      if(e.key==="Enter"){e.preventDefault();send();}
    });
    inputEl.addEventListener("touchend",()=>setTimeout(()=>inputEl.focus(),0));
    closeEl.onclick = ()=>document.getElementById("alfred-container").style.display="none";
  </script>
</body>
</html>
