<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Universo Culinario Magico ‚ú® ‚Ä¢ Team Due Mori</title>

    <!-- Font: Usiamo Orbitron per il titolo, Roboto per il resto -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <!-- Considera Font Awesome per icone vere: <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> -->

    <!-- Three.js via CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        /* Reset & Base */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            font-family: 'Roboto', sans-serif;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: #020008; /* Sfondo base scurissimo */
            color: #fff;
        }

        /* Contenitore Sfondo 3D */
        #magic-background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
        }
        #magic-background-container canvas { display: block; }

        /* Navbar Magica */
        .navbar {
            background: linear-gradient(135deg, rgba(10, 0, 25, 0.75), rgba(5, 0, 15, 0.85));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 12px 25px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 500;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 20px rgba(100, 50, 180, 0.25);
            border-bottom: 1px solid rgba(150, 80, 220, 0.4);
        }

        /* Pulsante Menu Magico */
        .dropdown { position: relative; display: inline-block; }
        .magic-menu-button {
            background: none;
            border: 1px solid rgba(180, 110, 255, 0.6);
            color: #d0a0ff;
            font-size: 20px; /* Dimensione icona placeholder */
            cursor: pointer;
            transition: all 0.3s ease;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 0 10px rgba(210, 160, 255, 0.7);
        }
        /* === IMPORTANTE: USA ICONA VERA === */
        .magic-menu-button::before {
             content: "ü™Ñ"; /* Placeholder! Usa SVG o Font Awesome (es. <i class="fas fa-wand-magic-sparkles"></i>) */
             display: block;
             transition: transform 0.3s ease;
        }

        .magic-menu-button:hover, .magic-menu-button:focus {
            color: #fff;
            border-color: rgba(255, 255, 255, 0.9);
            background-color: rgba(180, 110, 255, 0.1);
            box-shadow: 0 0 18px rgba(180, 110, 255, 0.6);
        }
         .magic-menu-button:hover::before {
            transform: scale(1.2) rotate(20deg);
        }

        /* Menu Dropdown Stilizzato */
        .dropdown-content {
            display: none;
            position: absolute;
            background: linear-gradient(135deg, rgba(15, 5, 30, 0.9), rgba(30, 10, 55, 0.95));
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            min-width: 250px;
            box-shadow: 0px 12px 30px rgba(0, 0, 0, 0.6);
            z-index: 999;
            border-radius: 10px;
            margin-top: 12px;
            border: 1px solid rgba(150, 80, 220, 0.5);
            overflow: hidden;
        }
        /* ... stili interni menu (link, sottomenu) come nella versione precedente ... */
        .dropdown-content ul { list-style-type: none; }
        .dropdown-content ul li a {
            color: #d0a0ff; padding: 15px 22px; text-decoration: none; display: block;
            font-family: 'Roboto', sans-serif; transition: all 0.3s ease;
            border-bottom: 1px solid rgba(150, 80, 220, 0.15);
        }
        .dropdown-content ul li:last-child a { border-bottom: none; }
        .dropdown-content ul li a:hover { background-color: rgba(180, 100, 255, 0.2); color: #fff; padding-left: 28px; }
        .show { display: block; animation: fadeInMenu 0.35s ease-out; }
        @keyframes fadeInMenu { from { opacity: 0; transform: translateY(-15px); } to { opacity: 1; transform: translateY(0); } }
        /* Sottomenu */
        .dropdown-content ul li.submenu-item .submenu { display: none; padding-left: 0; background-color: rgba(0, 0, 0, 0.35); }
        .dropdown-content ul li.submenu-item .submenu ul li a { padding: 12px 22px 12px 40px; font-size: 0.9em; }
        .dropdown-content ul li.submenu-item .submenu ul li a:hover { padding-left: 45px; }
        .dropdown-content ul li.submenu-item .submenu.open { display: block; }
        .submenu-trigger .arrow { color: #d0a0ff; /* Stile freccia */ }


        /* Titolo Eroe Stilizzato */
        #hero-title-container {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center; z-index: 5; padding: 20px;
            width: 90%; max-width: 950px;
            text-shadow: 0 0 12px rgba(255, 255, 255, 0.5),
                         0 0 25px rgba(200, 150, 255, 0.4),
                         0 0 45px rgba(150, 80, 220, 0.35);
            animation: pulseGlow 6s infinite alternate ease-in-out;
        }
         @keyframes pulseGlow {
            from { text-shadow: 0 0 10px rgba(255, 255, 255, 0.4), 0 0 20px rgba(200, 150, 255, 0.3), 0 0 35px rgba(150, 80, 220, 0.2); }
            to { text-shadow: 0 0 15px rgba(255, 255, 255, 0.6), 0 0 30px rgba(200, 150, 255, 0.5), 0 0 50px rgba(150, 80, 220, 0.45); }
        }
        #hero-title-container h1 {
            font-family: 'Orbitron', cursive;
            font-size: 4.8rem; font-weight: 700; margin-bottom: 0.3em;
            line-height: 1.1; letter-spacing: 4px; text-transform: uppercase;
            color: #fff;
        }
        #hero-title-container p {
            font-family: 'Roboto', sans-serif;
            font-size: 1.6rem; font-weight: 300; line-height: 1.6;
            opacity: 0.9; color: #e8d8ff;
        }
        /* Media queries titolo */
        @media (max-width: 992px) { #hero-title-container h1 { font-size: 3.8rem; } #hero-title-container p { font-size: 1.4rem; } }
        @media (max-width: 768px) { #hero-title-container h1 { font-size: 3rem; } #hero-title-container p { font-size: 1.2rem; } }
        @media (max-width: 480px) { #hero-title-container h1 { font-size: 2.2rem; letter-spacing: 2px; } #hero-title-container p { font-size: 1rem; } }

        /* Bottone Chat Magico */
        #goChatContainer { position: fixed; bottom: 25px; right: 25px; z-index: 1000; }
        #goChat {
            width: 75px; height: 75px; border: none; border-radius: 50%;
            background: radial-gradient(circle, rgba(170, 90, 255, 0.85) 0%, rgba(70, 30, 130, 0.95) 70%);
            box-shadow: 0 0 18px rgba(170, 90, 255, 0.6), 0 0 30px rgba(170, 90, 255, 0.4);
            cursor: pointer; position: relative; transition: all 0.3s ease-out;
            display: flex; align-items: center; justify-content: center;
        }
        /* === IMPORTANTE: USA ICONA VERA === */
        #goChat::before {
             content: "üí¨"; /* Placeholder! Usa SVG o Font Awesome (es. <i class="fas fa-comments"></i>) */
             font-size: 32px; color: #fff;
             text-shadow: 0 0 6px rgba(0, 0, 0, 0.6);
             filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
             transition: transform 0.3s ease;
        }
        #goChat::after { /* Effetto pulsazione */
            content: ''; position: absolute; top: -6px; left: -6px; right: -6px; bottom: -6px;
            border-radius: 50%; border: 2px solid rgba(170, 90, 255, 0.6);
            opacity: 0; animation: pulseBorder 2.8s infinite ease-out 0.5s; /* Ritardo animazione */
         }
         @keyframes pulseBorder { 0%{transform:scale(.9);opacity:0} 50%{opacity:1} 100%{transform:scale(1.35);opacity:0} }

        #goChat:hover {
            transform: scale(1.1);
            box-shadow: 0 0 28px rgba(190, 120, 255, 0.8), 0 0 45px rgba(190, 120, 255, 0.6);
        }
         #goChat:hover::before { transform: scale(1.1); }
        #goChat:active { transform: scale(0.98); box-shadow: 0 0 12px rgba(170, 90, 255, 0.5); }

        /* Contenuto Principale (Nascosto) */
        .main-content { /* ... Stile invariato se nascosto ... */ display: none; }

    </style>
</head>
<body>

    <div class="navbar">
        <div class="dropdown">
            <button onclick="toggleMenu()" class="magic-menu-button" aria-label="Apri Menu"></button>
            <div id="menuContent" class="dropdown-content">
                <p style="padding: 15px 22px; color: #aaa;">Caricamento menu...</p>
            </div>
        </div>
    </div>

    <div id="magic-background-container"></div>

    <div id="hero-title-container">
        <h1>Team Due Mori</h1>
        <p>Dove la magia incontra il gusto... dopo il caff√®! üë®‚Äçüç≥ü•¶üç∑‚ú®</p>
    </div>

    <div id="goChatContainer">
        <a href="chat.html" aria-label="Apri chat"><button id="goChat"></button></a>
    </div>

    <div class="main-content"></div>

    <script>
        // Script Menu a Tendina (Leggermente adattato per nuovo selettore bottone)
        function toggleMenu() { /* ... codice precedente ... */
            const menuContent = document.getElementById("menuContent");
            const isCurrentlyShown = menuContent.classList.contains("show");
            if (!isCurrentlyShown && (menuContent.querySelector('p') || menuContent.innerHTML.trim() === '')) {
                fetch('menu.html')
                .then(response => { if (!response.ok) throw new Error('Errore caricamento menu.html: ' + response.status); return response.text(); })
                .then(data => { menuContent.innerHTML = data.trim() === '' ? '<p style="padding: 10px; color: #888;">Menu vuoto.</p>' : data; })
                .catch(error => { menuContent.innerHTML = '<p style="padding: 10px; color: red;">Errore caricamento menu.</p>'; console.error('Dettagli errore fetch menu.html:', error); });
            }
            menuContent.classList.toggle("show");
            if (!menuContent.classList.contains("show")) { /* ... chiusura sottomenu ... */ }
        }
        function toggleSubmenu(event, triggerElement) { /* ... codice precedente ... */ }
        window.onclick = function(event) {
             const menuContent = document.getElementById("menuContent");
             const dropdownButton = document.querySelector('.magic-menu-button'); // SELETTORE AGGIORNATO
             if (menuContent && dropdownButton && !dropdownButton.contains(event.target) && !menuContent.contains(event.target)) {
                 if (menuContent.classList.contains("show")) { /* ... chiusura menu ... */ }
             }
        };

        // --- Script Universo 3D Magico ---
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('magic-background-container');
            if (!container) { console.error("Contenitore #magic-background-container non trovato!"); return; }

            // --- Configurazione ---
            // Usa la prima immagine utente per lo sfondo
            const userImageNames = ['home.PNG', 'home1.PNG', 'home2.PNG', 'home3.PNG', 'home4.PNG', 'home5.PNG', 'home6.PNG', 'home7.PNG'];
            const backgroundTextureImage = userImageNames.length > 0 ? userImageNames[0] : null; // Usa la prima se esiste

            // === IMPORTANTE: Fornisci i file PNG per questi emoji! ===
            const emojiImageNames = [
                // Piatti Ristorante Serio
                'spaghetti.png', 'steak.png', 'sushi.png', 'salad.png', 'soup.png', 'shrimp.png',
                // Verdure
                'broccoli.png', 'carrot.png', 'tomato.png', 'mushroom.png', 'eggplant.png',
                // Staff
                'chef-male.png', 'chef-female.png',
                // Attrezzatura / Bevande
                'plate-fork-knife.png', 'wine-glass.png', 'clinking-glasses.png', 'salt-shaker.png'
            ];
            const PARTICLE_COUNT = 8000; // Pi√π particelle per profondit√†
            const EMOJI_INSTANCE_COUNT = 60; // Quanti emoji in totale?
            const GEOMETRY_COUNT = 40; // Quante forme magiche?

            let scene, camera, renderer;
            let backgroundSphere, particles, emojiSprites = [], magicShapes = [];
            let mouse = new THREE.Vector2();
            let targetRotation = { x: 0, y: 0 }; // Rotazione target per interazione
            let deviceOrientation = null;
            const clock = new THREE.Clock(); // Per animazioni basate sul tempo

            // --- Inizializzazione ---
            function init() {
                scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x03000A, 0.0006); // Nebbia pi√π densa e scura

                camera = new THREE.PerspectiveCamera(65, window.innerWidth / window.innerHeight, 1, 5000);
                camera.position.z = 1000;

                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x020008); // Match CSS background
                renderer.outputEncoding = THREE.sRGBEncoding;
                container.appendChild(renderer.domElement);

                // Luci
                scene.add(new THREE.AmbientLight(0x7040AA, 0.7)); // Viola pi√π intenso
                const light1 = new THREE.PointLight(0xA060FF, 1, 2500, 2);
                light1.position.set(600, 400, 700);
                scene.add(light1);
                const light2 = new THREE.PointLight(0xFFC070, 0.8, 2200, 2); // Calda pesca/arancio
                light2.position.set(-600, -300, 500);
                scene.add(light2);

                // Creazione Elementi
                createBackgroundUniverse();
                createMagicParticles();
                createFloatingEmojis();
                createMagicShapes();

                // Eventi
                window.addEventListener('resize', onWindowResize);
                document.addEventListener('mousemove', onMouseMove);
                setupDeviceOrientation(); // Setup sensori mobile

                console.log("Inizializzazione 3D completata.");
                animate();
            }

            // --- Creazione Elementi Scena ---
            function createBackgroundUniverse() {
                if (!backgroundTextureImage) return; // Non fare nulla se non c'√® immagine utente

                const textureLoader = new THREE.TextureLoader();
                textureLoader.load(backgroundTextureImage, (texture) => {
                    texture.encoding = THREE.sRGBEncoding;
                    // Applica la texture a una sfera gigante invertita
                    const geometry = new THREE.SphereGeometry(2500, 60, 40);
                    // Inverti la geometria per vederla dall'interno
                    geometry.scale(-1, 1, 1);

                    const material = new THREE.MeshBasicMaterial({
                        map: texture,
                        fog: false, // Lo sfondo non √® influenzato dalla nebbia
                        color: 0xAAAAFF, // Tinta leggermente blu/viola per effetto cosmico
                        transparent: true,
                        opacity: 0.5 // Rendi un po' trasparente per vedere il colore di sfondo sotto
                    });

                    backgroundSphere = new THREE.Mesh(geometry, material);
                    scene.add(backgroundSphere);
                    console.log("Sfondo universo creato con: ", backgroundTextureImage);

                }, undefined, (err) => {
                    console.error(`Errore caricamento texture sfondo ${backgroundTextureImage}:`, err);
                });
            }

            function createMagicParticles() {
                // ... (Codice simile a prima per le stelle/particelle, magari con colori pi√π vibranti) ...
                const geometry = new THREE.BufferGeometry();
                const positions = []; const colors = []; const sizes = [];
                const color = new THREE.Color();

                for (let i = 0; i < PARTICLE_COUNT; i++) {
                    positions.push(THREE.MathUtils.randFloatSpread(3500)); // Ampia distribuzione
                    positions.push(THREE.MathUtils.randFloatSpread(3500));
                    positions.push(THREE.MathUtils.randFloatSpread(3000) - 500); // Leggermente spostate indietro

                    color.setHSL(THREE.MathUtils.randFloat(0.5, 0.8), 1.0, THREE.MathUtils.randFloat(0.7, 1.0)); // Blu/Viola/Magenta
                    colors.push(color.r, color.g, color.b);
                    sizes.push(THREE.MathUtils.randFloat(2, 5)); // Dimensioni variabili
                }
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
                geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
                geometry.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));

                const material = new THREE.PointsMaterial({
                    vertexColors: true,
                    sizeAttenuation: true,
                    transparent: true,
                    opacity: 0.9,
                    blending: THREE.AdditiveBlending, // Effetto luminoso
                    depthWrite: false, // Evita artefatti di trasparenza
                     size: 10 // Dimensione base, moltiplicata dall'attributo 'size'
                });

                particles = new THREE.Points(geometry, material);
                scene.add(particles);
            }

             function createFloatingEmojis() {
                const textureLoader = new THREE.TextureLoader();
                if (emojiImageNames.length === 0) return;

                for (let i = 0; i < EMOJI_INSTANCE_COUNT; i++) {
                    const imgName = emojiImageNames[i % emojiImageNames.length]; // Cicla tra gli emoji disponibili
                    textureLoader.load(imgName, (texture) => {
                        texture.encoding = THREE.sRGBEncoding;
                        const material = new THREE.SpriteMaterial({
                            map: texture, color: 0xffffff, transparent: true,
                            opacity: 0.95, sizeAttenuation: true, fog: true
                        });
                        const sprite = new THREE.Sprite(material);
                        const scale = THREE.MathUtils.randFloat(35, 65); // Dimensioni emoji
                        sprite.scale.set(scale, scale, 1);
                        sprite.position.set(
                            THREE.MathUtils.randFloatSpread(2200),
                            THREE.MathUtils.randFloatSpread(2200),
                            THREE.MathUtils.randFloatSpread(1800) - 300 // Un po' pi√π vicini
                        );
                        sprite.userData.velocity = new THREE.Vector3(
                            (Math.random() - 0.5) * 0.4, (Math.random() - 0.5) * 0.4, (Math.random() - 0.5) * 0.4
                        );
                         sprite.userData.rotationSpeed = (Math.random() - 0.5) * 0.01; // Rotazione su Z
                        sprite.userData.initialY = sprite.position.y; // Per bobbing
                        scene.add(sprite);
                        emojiSprites.push(sprite);
                    }, undefined, (err) => console.warn(`Errore caricamento texture emoji ${imgName}:`, err)); // Warn non blocca
                }
            }

            function createMagicShapes() {
                const geometries = [
                    new THREE.TetrahedronGeometry(THREE.MathUtils.randFloat(15, 30)),
                    new THREE.OctahedronGeometry(THREE.MathUtils.randFloat(15, 30)),
                    new THREE.IcosahedronGeometry(THREE.MathUtils.randFloat(15, 30)),
                    new THREE.TorusKnotGeometry(THREE.MathUtils.randFloat(10, 20), 3, 100, 8) // Nodi toroidali
                ];
                 const materials = [
                    new THREE.MeshStandardMaterial({ color: 0xffaaff, emissive: 0xaa66cc, roughness: 0.4, metalness: 0.2 }),
                    new THREE.MeshStandardMaterial({ color: 0xaaffff, emissive: 0x66cccc, roughness: 0.4, metalness: 0.2 }),
                    new THREE.MeshBasicMaterial({ color: 0xffffaa, wireframe: true, transparent: true, opacity: 0.7 })
                 ];

                for (let i = 0; i < GEOMETRY_COUNT; i++) {
                    const geometry = geometries[i % geometries.length];
                    const material = materials[i % materials.length].clone(); // Clona per evitare side effect
                    const mesh = new THREE.Mesh(geometry, material);
                     mesh.position.set(
                        THREE.MathUtils.randFloatSpread(2000),
                        THREE.MathUtils.randFloatSpread(2000),
                        THREE.MathUtils.randFloatSpread(1600) - 200
                    );
                    mesh.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
                    mesh.userData.rotationSpeed = { x: (Math.random()-0.5)*0.005, y: (Math.random()-0.5)*0.005, z:(Math.random()-0.5)*0.005 };
                    scene.add(mesh);
                    magicShapes.push(mesh);
                }
            }


            // --- Gestione Eventi ---
            function onWindowResize() { /* ... come prima ... */ }
            function onMouseMove(event) { /* ... come prima ... */ }
            function handleDeviceOrientation(event) { /* ... come prima ... */ }
            function setupDeviceOrientation() { /* ... come prima, con gestione permessi ... */ }


            // --- Loop Animazione ---
            function animate() {
                requestAnimationFrame(animate);
                const delta = clock.getDelta(); // Tempo trascorso dall'ultimo frame
                const elapsedTime = clock.getElapsedTime(); // Tempo totale

                render(delta, elapsedTime);
            }

            function render(delta, time) {
                // Aggiornamento Camera (LERP per fluidit√†)
                camera.rotation.x += (targetRotation.x - camera.rotation.x) * 0.05;
                camera.rotation.y += (targetRotation.y - camera.rotation.y) * 0.05;

                // Rotazione Sfondo (molto lenta per non dare fastidio)
                if (backgroundSphere) backgroundSphere.rotation.y = time * 0.005;

                // Rotazione Particelle
                if (particles) particles.rotation.y = time * 0.02;

                // Animazione Emoji
                emojiSprites.forEach(sprite => {
                    sprite.position.addScaledVector(sprite.userData.velocity, delta * 60); // Movimento indipendente dal frame rate
                    sprite.rotation.z += sprite.userData.rotationSpeed * delta * 60;
                    // Bobbing verticale
                    sprite.position.y = sprite.userData.initialY + Math.sin(time * 1.5 + sprite.position.x * 0.1) * 10; // Bobbing pi√π complesso

                    // Boundary check (teletrasporto invece di rimbalzo?)
                    if (Math.abs(sprite.position.x) > 1300) sprite.position.x *= -0.99; // Ritorna lentamente
                    if (Math.abs(sprite.position.y) > 1300) sprite.position.y *= -0.99;
                    if (Math.abs(sprite.position.z) > 1000) sprite.position.z *= -0.99;
                });

                // Animazione Forme Magiche
                magicShapes.forEach(mesh => {
                    mesh.rotation.x += mesh.userData.rotationSpeed.x * delta * 60;
                    mesh.rotation.y += mesh.userData.rotationSpeed.y * delta * 60;
                    mesh.rotation.z += mesh.userData.rotationSpeed.z * delta * 60;
                });

                renderer.render(scene, camera);
            }

            // --- Avvio ---
            try {
                 init();
            } catch (error) {
                 console.error("Errore CRITICO durante l'inizializzazione 3D:", error);
                 // Potresti mostrare un messaggio di errore all'utente qui
                 container.innerHTML = "<p style='color:red; padding: 20px;'>Oops! Qualcosa √® andato storto con la magia 3D. Controlla la console.</p>";
            }
        });
    </script>

</body>
</html>
