<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Team Due Mori + Alfred Bot</title>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#f5f5f5; }
    #chat-container {
      position: fixed;
      bottom: 20px; right: 20px;
      width: 300px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      border-radius: 8px;
      overflow: hidden;
      background: #fff;
    }
    #chat-header {
      background: #2c3e50; color:#fff;
      padding: 10px; font-weight:bold;
      display:flex; justify-content:space-between;
      align-items:center;
    }
    #chat-body {
      max-height: 300px; overflow-y: auto;
      padding: 10px;
    }
    .msg { margin:8px 0; }
    .msg.user { text-align: right; }
    .msg.bot  { text-align: left; }
    .msg .bubble {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 16px;
      max-width: 80%;
    }
    .msg.user .bubble { background: #3498db; color:#fff; }
    .msg.bot  .bubble { background: #ecf0f1; color:#333; }
    #chat-input {
      display:flex; border-top:1px solid #ddd;
    }
    #chat-input input {
      flex:1; border:none; padding:10px;
      outline:none;
    }
    #chat-input button {
      border:none; background:#3498db; color:#fff;
      padding:0 16px; cursor:pointer;
    }
  </style>
</head>
<body>

  <!-- IL TUO HEADER / MAIN CONTENT QUI SOPRAâ€¦ -->

  <div id="chat-container">
    <div id="chat-header">
      <span>Alfred Bot ðŸ¤–</span>
      <button id="chat-close">Ã—</button>
    </div>
    <div id="chat-body"></div>
    <div id="chat-input">
      <input type="text" id="input" placeholder="Scrivi quiâ€¦" />
      <button id="send">â†’</button>
    </div>
  </div>

  <script>
    const bodyEl = document.getElementById("chat-body");
    const inputEl = document.getElementById("input");
    const sendBtn = document.getElementById("send");
    const closeBtn = document.getElementById("chat-close");
    const container = document.getElementById("chat-container");

    closeBtn.onclick = () => container.style.display = "none";
    sendBtn.onclick  = sendMessage;
    inputEl.addEventListener("keydown", e => e.key === "Enter" && sendMessage());

    function appendMessage(text, who) {
      const msgEl = document.createElement("div");
      msgEl.className = "msg " + who;
      msgEl.innerHTML = `<div class="bubble">${text}</div>`;
      bodyEl.appendChild(msgEl);
      bodyEl.scrollTop = bodyEl.scrollHeight;
    }

    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;
      appendMessage(text, "user");
      inputEl.value = "";
      try {
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });
        const { reply } = await res.json();
        appendMessage(reply, "bot");
      } catch {
        appendMessage("Errore di connessione ðŸ˜¢", "bot");
      }
    }
  </script>

</body>
</html>
