<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Chat demoÂ â€¢Â Alfred</title>
<style>
/* RESET + blocco scroll documento */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LAYOUT PRINCIPALE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app{
  position:fixed;inset:0;               /* riempie SEMPRE il viewport visibile */
  display:flex;flex-direction:column;
  background:#ece5dd;
  /* il paddingâ€‘bottom verrÃ  sovrascritto da JS */
  padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}

/* header */
header{
  flex:none;height:48px;line-height:48px;background:#075e54;color:#fff;
  display:flex;align-items:center;gap:12px;padding:0 16px;font-weight:500}
header a{font-size:28px;text-decoration:none;color:inherit}
header span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* lista messaggi */
#log{
  flex:1 1 auto;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:6px;
}

/* input bar */
form{
  flex:none;height:56px;background:#f0f0f0;display:flex;align-items:center;gap:8px;padding:0 8px}
form input{flex:1;border:none;border-radius:20px;padding:10px 14px;font-size:15px;background:#fff}
form button{border:none;width:46px;height:46px;border-radius:50%;background:#25d366;display:flex;align-items:center;justify-content:center}

/* bolle (minime per demo) */
.bubble{max-width:75%;padding:8px 10px;border-radius:8px;font-size:14px;line-height:1.35}
.me  {align-self:flex-end;background:#d1f8c6;border-radius:8px 0 8px 8px}
.you {align-self:flex-start;background:#fff;border-radius:0 8px 8px 8px}
</style>
</head>
<body>

<div id="app">
  <header><a href="#">â€¹</a><span>DonÂ Alfred ğŸ¤µğŸ»â€â™‚ï¸</span></header>

  <div id="log" role="log" aria-live="polite"></div>

  <form id="chatForm" autocomplete="off">
    <input id="txt" placeholder="Messaggio" enterkeyhint="send">
    <button type="submit">â–¶</button>
  </form>
</div>

<script>
/* â”€â”€â”€â”€â”€ UTIL â”€â”€â”€â”€â”€ */
const $ = s => document.querySelector(s);
const log = $('#log'), txt = $('#txt'), form = $('#chatForm');

/* â”€â”€â”€â”€â”€ 1.  ADATTA IL LAYOUT ALLA KEYBOARD â”€â”€â”€â”€â”€ */
function adapt(){
  const vv = window.visualViewport;
  // h = altezza visibile (esclude tastiera & urlâ€‘bar fluttuante)
  const h = vv ? vv.height : innerHeight;
  // distanza tra viewport "pieno" e visibile â†’ tastiera | url bar | nulla
  const bottomPad = innerHeight - h - (vv ? vv.offsetTop : 0);

  // aggiorna altezza app + padding bottom
  document.getElementById('app').style.height = h + 'px';
  document.getElementById('app').style.paddingBottom = `calc(env(safe-area-inset-bottom) + ${bottomPad}px)`;

  // tieni il log scrollato in fondo
  log.scrollTop = log.scrollHeight;
}
// prima chiamata
adapt();
// eventi che cambiano viewport
(window.visualViewport||window).addEventListener('resize', adapt);
(window.visualViewport||window).addEventListener('scroll',  adapt);
window.addEventListener('orientationchange', adapt);

/* â”€â”€â”€â”€â”€ 2.  BLOCCA QUALSIASI SCROLL DEL DOCUMENTO â”€â”€â”€â”€â”€ */
addEventListener('scroll', ()=>scrollTo(0,0));

/* â”€â”€â”€â”€â”€ 3.  INVIO MESSAGGIO DEMO (niente backend) â”€â”€â”€â”€â”€ */
function addBubble(cls,txtContent){
  const div = document.createElement('div');
  div.className = `bubble ${cls}`;
  div.textContent = txtContent;
  log.appendChild(div);
  adapt();                               // ricentra dopo append
}

form.addEventListener('submit', e=>{
  e.preventDefault();
  const t = txt.value.trim();
  if(!t) return;
  addBubble('me', t);
  txt.value = '';
  setTimeout(()=>addBubble('you', 'Risposta di test ğŸ˜‰'), 400);
});
</script>
</body>
</html>
