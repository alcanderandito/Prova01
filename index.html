<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Team Due Mori (Mobile Only)</title>

  <style>
    /* RESET & BASE */
    *{margin:0;padding:0;box-sizing:border-box;}
    html,body{width:100%;height:100%;overflow-y:scroll;font-family:Arial,Helvetica,sans-serif;}

    /* ----------  SOLO MOBILE (‚â§600 px) ---------- */
    @media (max-width:600px){

      /* BACKGROUND */
      .bg{position:fixed;top:50%;left:50%;width:120%;height:120%;object-fit:cover;
          transform:translate(-50%,-50%) scale(1);transform-origin:center center;z-index:-2;}
      .overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:-1;pointer-events:none;}

      /* HEADER */
      header{height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;
              text-align:center;color:#fff;padding:0 20px;}
      h1{font-size:2.2rem;font-weight:700;letter-spacing:.05em;text-shadow:0 1px 4px rgba(0,0,0,.7);margin-bottom:.3em;}
      .subtitle{font-size:.95rem;text-shadow:0 1px 3px rgba(0,0,0,.7);margin-bottom:1em;}
      #scrollIndicator{font-size:2rem;color:#fff;cursor:pointer;animation:pulse 1.5s ease-in-out infinite;}
      @keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.3);}}

      /* GRID 2√óN fissa */
      main{position:relative;z-index:1;min-height:200vh;padding:40px 20px 80px;}
      .nav{display:grid;gap:20px;justify-items:center;grid-template-columns:repeat(2,1fr);margin:0 auto;max-width:480px;}
      .nav a{width:100px;height:100px;border-radius:50%;display:flex;align-items:center;justify-content:center;
             font-size:.9rem;font-weight:600;color:#fff;text-decoration:none;background:rgba(255,255,255,.5);
             backdrop-filter:blur(4px);border:1px solid rgba(255,255,255,.3);box-shadow:0 4px 12px rgba(0,0,0,.2);
             opacity:0;transform:scale(0);animation:popIn .5s ease forwards,breath 3s ease-in-out infinite .6s;}
      @keyframes popIn{0%{opacity:0;transform:scale(0);}60%{opacity:1;transform:scale(1.2);}100%{opacity:1;transform:scale(1);}}
      @keyframes breath{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}
      .nav a:hover{box-shadow:0 0 8px rgba(255,255,255,.8),0 0 16px rgba(255,255,255,.6);transform:translateY(-4px) scale(1.05);}
      .nav a:active{transform:translateY(0) scale(1.02);box-shadow:inset 0 2px 6px rgba(0,0,0,.3);}

      /* CHAT FLOAT */
      #chatToggle{position:fixed;top:1rem;right:1rem;width:60px;height:60px;border:none;border-radius:50%;
                  background:#0094ff url("https://img.icons8.com/ios-filled/50/ffffff/chat--v1.png") center/55% no-repeat;
                  cursor:grab;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,.25);transition:transform .15s;}
      #chatToggle:active{transform:scale(.95);}

      #chatContainer{position:fixed;width:85vw;height:50vh;display:none;max-width:none;
                     z-index:1100;resize:none;overflow:hidden;cursor:grab;}
      .chatBox{width:100%;height:100%;display:flex;flex-direction:column;border:2px solid #00345f;border-radius:6px;
               box-shadow:0 4px 12px rgba(0,0,0,.25);background:#fff;font-size:14px;}
      .chatBar{background:#00345f;color:#fff;padding:8px 12px;font-weight:700;display:flex;justify-content:space-between;
               align-items:center;user-select:none;cursor:grab;touch-action:none;}   /* <-- fix iOS */

      .chatBody{flex:1;overflow-y:auto;padding:6px 10px;}
      .chatBody .msg{margin:4px 0;display:flex;}
      .chatBody .bot .bubble{background:#f1f1f1;color:#000;align-self:flex-start}
      .chatBody .user .bubble{background:#0094ff;color:#fff;align-self:flex-end}
      .bubble{padding:6px 10px;border-radius:12px;max-width:75%;word-wrap:break-word;}
      .chatInput{display:flex;border-top:1px solid #ccc;}
      .chatInput input{flex:1;padding:10px;border:none;font-size:14px;}
      .chatInput button{width:52px;border:none;background:#0094ff;color:#fff;font-size:18px;cursor:pointer;}
    }

    /* ----------  BLOCCA DESKTOP (‚â•601 px) ---------- */
    @media (min-width:601px){
      /* nasconde tutto l‚Äôapp vero e proprio */
      header,main,#chatToggle,#chatContainer,.bg,.overlay{display:none!important;}

      /* schermata di avviso */
      body::before{
        content:"üõë  Questo sito √® ottimizzato solo per smartphone.\\A  Aprilo dal tuo telefono, gigante! üòú";
        white-space:pre-line;
        display:flex;
        align-items:center;
        justify-content:center;
        height:100vh;
        width:100%;
        text-align:center;
        font-size:2.5rem;
        font-family:Arial,Helvetica,sans-serif;
        background:#000;
        color:#fff;
        padding:0 5vw;
      }

      html,body{overflow:hidden;}
    }
  </style>
</head>
<body>

  <!-- BACKGROUND -->
  <img src="home.PNG" class="bg" id="bg" alt="">
  <div class="overlay"></div>

  <!-- CHAT -->
  <button id="chatToggle" aria-label="Apri chat"></button>
  <div id="chatContainer">
    <div class="chatBox" id="chatBox">
      <div class="chatBar" id="dragBar">
        Don Alfred ü§µüèª‚Äç‚ôÇÔ∏è <span id="chatClose" style="cursor:pointer;font-weight:400;">‚úï</span>
      </div>
      <div class="chatBody" id="chatBody"></div>
      <form class="chatInput" id="chatForm" autocomplete="off">
        <input id="chatInput" placeholder="Scrivi qui‚Ä¶"/>
        <button type="submit">‚û§</button>
      </form>
    </div>
  </div>

  <!-- CONTENUTO -->
  <header>
    <h1>Team Due Mori</h1>
    <div class="subtitle">Sfoglia le schede del Dream-Team.</div>
    <div id="scrollIndicator">&#8595;</div>
  </header>

  <main id="main">
    <nav class="nav" id="teamNav">
      <!-- ‚Ä¶POPOLA QUI‚Ä¶ -->
    </nav>
  </main>

  <!-- SCRIPT originale (non toccato) -->
  <script>
    /* BG zoom e scroll indicator */
    window.addEventListener('scroll',()=>{
      const f = Math.min(window.scrollY/200,1);
      document.getElementById('bg').style.transform = `translate(-50%,-50%) scale(${1+f*0.5})`;
    });
    document.getElementById('scrollIndicator').onclick = ()=>
      document.getElementById('teamNav').scrollIntoView({behavior:'smooth'});

    /* DRAG helper */
    function makeDraggable(el,handle){
      let ox=0,oy=0,down=false;
      const start=e=>{
        down=true;
        const ev = e.touches ? e.touches[0] : e;
        ox = ev.clientX - el.offsetLeft;
        oy = ev.clientY - el.offsetTop;
        document.addEventListener('mousemove',move);
        document.addEventListener('touchmove',move,{passive:false});
      };
      const stop=()=>{
        down=false;
        document.removeEventListener('mousemove',move);
        document.removeEventListener('touchmove',move);
      };
      const move=e=>{
        if(!down) return;
        e.preventDefault();
        const ev = e.touches ? e.touches[0] : e;
        el.style.left = Math.max(0, ev.clientX - ox) + 'px';
        el.style.top  = Math.max(0, ev.clientY - oy) + 'px';
      };
      (handle||el).addEventListener('mousedown',start);
      (handle||el).addEventListener('touchstart',start,{passive:false});
      document.addEventListener('mouseup',stop);
      document.addEventListener('touchend',stop);
    }

    /* CENTRATURA iniziale */
    const chatContainer = document.getElementById('chatContainer');
    function centerBox(){
      const w = chatContainer.offsetWidth;
      const h = chatContainer.offsetHeight;
      chatContainer.style.left = `calc(50vw - ${w/2}px)`;
      chatContainer.style.top  = `calc(50vh - ${h/2}px)`;
    }

    /* LOGICA CHAT */
    const chatToggle = document.getElementById('chatToggle'),
          chatClose  = document.getElementById('chatClose'),
          chatBody   = document.getElementById('chatBody'),
          chatForm   = document.getElementById('chatForm'),
          chatInput  = document.getElementById('chatInput'),
          history    = [];

    makeDraggable(chatToggle);
    makeDraggable(chatContainer, document.getElementById('dragBar'));

    chatToggle.onclick = ()=>{
      chatContainer.style.display = 'block';
      centerBox();
    };
    chatClose.onclick = ()=> chatContainer.style.display = 'none';

    chatForm.addEventListener('submit',async e=>{
      e.preventDefault();
      const text = chatInput.value.trim();
      if(!text) return;
      append('user', text); history.push({role:'user',content:text});
      chatInput.value=''; chatInput.focus();
      try {
        const { reply } = await (await fetch('/api/chat',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({message:text,history})
        })).json();
        append('bot', reply); history.push({role:'assistant',content:reply});
      } catch {
        append('bot','Errore di connessione üò¢');
      }
    });

    function append(who,txt){
      const row=document.createElement('div');
      row.className='msg '+who;
      row.innerHTML=`<div class="bubble">${txt}</div>`;
      chatBody.appendChild(row);
      chatBody.scrollTop=chatBody.scrollHeight;
    }

    /* ‚Äî Tastiera mobile ‚Äî */
    function onKeyboardShow(){
      if (!window.visualViewport) return;
      const vv = window.visualViewport;
      const newH = Math.round(vv.height * 0.75);
      chatContainer.style.height = `${newH}px`;
      const kb = window.innerHeight - vv.height;
      chatContainer.style.bottom = `${kb}px`;
      chatContainer.style.top = '';
      const w = chatContainer.offsetWidth;
      chatContainer.style.left = `${Math.round((vv.width - w)/2)}px`;
    }
    function onKeyboardHide(){
      chatContainer.style.height = '50vh';
      chatContainer.style.bottom = '';
      centerBox();
    }
    if (window.visualViewport) {
      window.visualViewport.addEventListener('resize',()=>{
        if (chatContainer.style.display==='block' && window.innerWidth<601) onKeyboardShow();
        else onKeyboardHide();
      });
    }
    chatInput.addEventListener('focus', onKeyboardShow);
    chatInput.addEventListener('blur',  onKeyboardHide);
  </script>
</body>
</html>
